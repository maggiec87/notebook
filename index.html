<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Notebook-æˆ‘çš„æ‰‹è´¦æœ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --- åŸºç¡€ä¸é…è‰² --- */
    :root {
      --bg-color: #fdfaf3;
      --card-color: #ffffff;
      --text-color: #3d352e;
      --muted-color: #8a7e74;
      --accent-color: #a08c7d;
      --action-color: #6a8b75; /* ä¿å­˜æŒ‰é’®é¢œè‰² */
      --export-color: #4a6e8a; /* å¯¼å‡ºæŒ‰é’®é¢œè‰²ï¼ŒæŸ”å’Œçš„è“è‰² */
      --shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
      --font-handwriting: "Kaiti", "STKaiti", "KaiTi_GB2312", "Comic Sans MS", cursive, sans-serif;
      --font-main: "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background-color: var(--bg-color);
      font-family: var(--font-main);
      color: var(--text-color);
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    header { text-align: center; margin: 20px 0 30px; }
    h1 { font-family: var(--font-handwriting); font-size: 2.5rem; margin: 0; }
    .subtitle { color: var(--muted-color); font-size: 0.9rem; margin-top: 8px; }

    /* --- å¯¼èˆª --- */
    .nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      padding-bottom: 20px;
      border-bottom: 2px dashed var(--accent-color);
      margin-bottom: 20px;
    }
    .nav-button {
      background-color: #fff;
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease-in-out;
    }
    .nav-button:hover { background-color: var(--accent-color); color: #fff; transform: translateY(-2px); }
    .nav-button.active { background-color: var(--text-color); border-color: var(--text-color); color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

    /* --- æ“ä½œæŒ‰é’®åŒºåŸŸ --- */
    .actions-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .action-button {
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    .action-button:hover { transform: translateY(-2px); }
    
    /* ä¿å­˜æŒ‰é’®æ ·å¼ */
    .save-btn { background-color: var(--action-color); box-shadow: 0 3px 8px rgba(106, 139, 117, 0.3); }
    .save-btn:hover { background-color: #587965; box-shadow: 0 5px 12px rgba(106, 139, 117, 0.4); }
    .save-all { background-color: #c5a992; box-shadow: 0 3px 8px rgba(197, 169, 146, 0.4); }
    .save-all:hover { background-color: #b3957c; box-shadow: 0 5px 12px rgba(197, 169, 146, 0.5); }
    
    /* å¯¼å‡ºæŒ‰é’®æ ·å¼ */
    .export-btn { background-color: var(--export-color); box-shadow: 0 3px 8px rgba(74, 110, 138, 0.3); }
    .export-btn:hover { background-color: #3b5a72; box-shadow: 0 5px 12px rgba(74, 110, 138, 0.4); }

    .save-status {
      color: var(--action-color);
      font-weight: bold;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      min-width: 100px; /* å ä½é˜²æ­¢æŒ‰é’®ç§»åŠ¨ */
      text-align: left;
    }
    .save-status.visible { opacity: 1; }

    /* --- é¡µé¢å¡ç‰‡ --- */
    .page { display: none; background-color: var(--card-color); border-radius: 12px; padding: 25px 30px; box-shadow: var(--shadow); animation: fadeIn 0.5s ease; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    h2 { font-family: var(--font-handwriting); font-size: 1.8rem; margin: 0 0 15px; }

    /* --- è¡¨å•å…ƒç´  --- */
    .note-area {
      width: 100%;
      min-height: 250px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e0d5cb;
      font-family: var(--font-handwriting);
      font-size: 1.1rem;
      line-height: 1.8;
      background-color: #fefdfb;
      resize: vertical;
      transition: border-color 0.2s;
    }
    .note-area:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(160, 140, 125, 0.2); }

    /* --- åº•éƒ¨ --- */
    footer { text-align: center; color: var(--muted-color); font-size: 0.8rem; margin-top: 40px; padding-bottom: 20px; }


    /* --- ç§»åŠ¨ç«¯é€‚é… (å“åº”å¼è®¾è®¡) --- */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      header {
        margin: 15px 0 20px;
      }

      h1 {
        font-size: 2rem;
      }

      .nav {
        gap: 8px;
        padding-bottom: 15px;
        margin-bottom: 15px;
      }
      
      .nav-button {
        padding: 6px 14px;
        font-size: 0.9rem;
      }

      /* å…³é”®æ”¹åŠ¨ï¼šå°†æ“ä½œæŒ‰é’®å‚ç›´å †å ï¼Œæ–¹ä¾¿ç§»åŠ¨ç«¯ç‚¹å‡» */
      .actions-bar {
        flex-direction: column;
        align-items: stretch; /* è®©å†…éƒ¨å…ƒç´ æ’‘æ»¡å®¹å™¨å®½åº¦ */
        gap: 10px;
      }

      .action-button {
        width: 100%; /* æŒ‰é’®å®½åº¦100% */
      }
      
      .save-status {
        min-width: 0; /* é‡ç½®æœ€å°å®½åº¦ */
        text-align: center; /* å±…ä¸­æ˜¾ç¤ºä¿å­˜çŠ¶æ€ */
        margin: 5px 0;
      }

      .page {
        padding: 20px 15px;
      }

      h2 {
        font-size: 1.6rem;
      }

      .note-area {
        min-height: 200px; /* å‡å°åœ¨å°å±å¹•ä¸Šçš„æœ€å°é«˜åº¦ */
        font-size: 1rem;
      }

      footer {
        margin-top: 30px;
        padding: 0 10px 15px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>æˆ‘çš„æ‰‹è´¦æœ¬</h1>
    <p class="subtitle">ä¸€ä¸ªé•¿æœŸé™ªä¼´ä½ çš„ä¸ªäººç¬”è®°æœ¬ï¼Œæ”¯æŒå¯¼å‡ºä¸è‡ªåŠ¨ä¿å­˜ã€‚</p>
  </header>

  <nav class="nav" id="notebook-nav">
    <button class="nav-button active" data-target="book">ğŸ“– è¯»ä¹¦</button>
    <button class="nav-button" data-target="podcast">ğŸ§ æ’­å®¢</button>
    <button class="nav-button" data-target="lyrics">ğŸµæ­Œè¯</button>
    <button class="nav-button" data-target="poems">âœï¸å†™è¯—</button>
    <button class="nav-button" data-target="inspire">ğŸ’¡çµæ„Ÿ</button>
    <button class="nav-button" data-target="food">ğŸ½ï¸é£Ÿç‰©</button>
    <button class="nav-button" data-target="money">ğŸ’°é’±é’±</button>
  </nav>

  <!-- æ›´æ–°ï¼šæ“ä½œæŒ‰é’®æ  -->
  <div class="actions-bar">
    <button id="save-current-btn" class="action-button save-btn">ä¿å­˜æœ¬é¡µ</button>
    <button id="save-all-btn" class="action-button save-all">âœ¨ ä¿å­˜å…¨éƒ¨</button>
    <span id="save-status" class="save-status"></span>
    <button id="export-txt-btn" class="action-button export-btn">å¯¼å‡ºTXT</button>
    <button id="export-csv-btn" class="action-button export-btn">å¯¼å‡ºCSV</button>
  </div>

  <main>
    <section id="book" class="page active">
      <h2>è¯»ä¹¦ç¬”è®°</h2>
      <textarea class="note-area" data-persist="book-notes" placeholder=""></textarea>
    </section>

    <section id="podcast" class="page">
      <h2>æ’­å®¢</h2>
      <textarea class="note-area" data-persist="podcast-notes" placeholder=""></textarea>
    </section>

    <section id="lyrics" class="page">
      <h2>æ­Œè¯</h2>
      <textarea class="note-area" data-persist="lyrics-notes" placeholder=""></textarea>
    </section>

    <section id="poems" class="page">
      <h2>å†™è¯—</h2>
      <textarea class="note-area" data-persist="poems-notes" placeholder=""></textarea>
    </section>

    <section id="inspire" class="page">
      <h2>çµæ„Ÿ</h2>
      <textarea class="note-area" data-persist="inspire-notes" placeholder="æ•æ‰é‚£äº›ç¨çºµå³é€çš„çµæ„Ÿç«èŠ±"></textarea>
    </section>

    <section id="food" class="page">
      <h2>é£Ÿç‰©</h2>
      <textarea class="note-area" data-persist="food-notes" placeholder=""></textarea>
    </section>

    <section id="money" class="page">
      <h2>é‡‘é’±</h2>
      <textarea class="note-area" data-persist="money-notes" placeholder=""></textarea>
    </section>
  </main>

  <footer>
    <p>æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ (LocalStorage)ï¼Œè¯·å‹¿åœ¨å…¬ç”¨ç”µè„‘ä¸Šä½¿ç”¨ã€‚æ›´æ¢è®¾å¤‡å‰è¯·æ‰‹åŠ¨å¤‡ä»½å†…å®¹ã€‚</p>
  </footer>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // --- è·å–å…ƒç´  ---
    const nav = document.getElementById('notebook-nav');
    const pages = document.querySelectorAll('.page');
    const textareas = document.querySelectorAll('.note-area');
    const saveCurrentBtn = document.getElementById('save-current-btn');
    const saveAllBtn = document.getElementById('save-all-btn');
    const saveStatus = document.getElementById('save-status');
    const exportTxtBtn = document.getElementById('export-txt-btn'); // æ–°å¢
    const exportCsvBtn = document.getElementById('export-csv-btn'); // æ–°å¢

    let statusTimer;

    // --- è¾…åŠ©å‡½æ•° ---

    // è·å–æ ¼å¼åŒ–çš„æ—¥æœŸå­—ç¬¦ä¸² YYYY-MM-DD
    function getFormattedDate() {
        const date = new Date();
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // åˆ›å»ºå¹¶è§¦å‘ä¸‹è½½
    function triggerDownload(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // --- åŠŸèƒ½å‡½æ•° ---

    function showSaveStatus(message) {
      clearTimeout(statusTimer);
      saveStatus.textContent = message;
      saveStatus.classList.add('visible');
      statusTimer = setTimeout(() => {
        saveStatus.classList.remove('visible');
      }, 2000);
    }

    function saveCurrentNote() {
      const activePage = document.querySelector('.page.active');
      if (!activePage) return;
      const textarea = activePage.querySelector('.note-area');
      const key = textarea.dataset.persist;
      localStorage.setItem(key, textarea.value);
      console.log(`Saved current: ${key}`);
      showSaveStatus('å½“å‰é¡µå·²ä¿å­˜ âœ“');
    }

    function saveAllNotes() {
      textareas.forEach(textarea => {
        const key = textarea.dataset.persist;
        if (key) localStorage.setItem(key, textarea.value);
      });
      console.log('Saved all notes.');
    }

    // --- æ–°å¢ï¼šå¯¼å‡ºåŠŸèƒ½ ---
    function exportAsTxt() {
        const activePage = document.querySelector('.page.active');
        if (!activePage) return;

        const textarea = activePage.querySelector('.note-area');
        const content = textarea.value;
        const title = activePage.querySelector('h2').textContent.trim();
        const filename = `${title}_${getFormattedDate()}.txt`;

        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        triggerDownload(blob, filename);
        showSaveStatus('TXT å·²å¯¼å‡º');
    }

    function exportAsCsv() {
        const activePage = document.querySelector('.page.active');
        if (!activePage) return;

        const textarea = activePage.querySelector('.note-area');
        const content = textarea.value;
        const title = activePage.querySelector('h2').textContent.trim();
        const filename = `${title}_${getFormattedDate()}.csv`;
        
        let csvContent = '';

        // é’ˆå¯¹â€œé’±æœ¬â€è¿›è¡Œç‰¹æ®Šå¤„ç†
        if (activePage.id === 'money') {
            const lines = content.split('\n');
            // å°† " | " æ›¿æ¢ä¸º ","
            csvContent = lines.map(line => line.replace(/\s*\|\s*/g, ',')).join('\n');
        } else {
            // å¯¹äºå…¶ä»–é¡µé¢ï¼Œå°†æ•´ä¸ªå†…å®¹æ”¾å…¥ä¸€ä¸ªå•å…ƒæ ¼ï¼Œå¹¶å¤„ç†åŒå¼•å·
            csvContent = `"${content.replace(/"/g, '""')}"`;
        }
        
        // æ·»åŠ  BOM ä»¥ç¡®ä¿ Excel æ­£ç¡®è¯†åˆ« UTF-8 ç¼–ç ï¼ˆç‰¹åˆ«æ˜¯ä¸­æ–‡ï¼‰
        const bom = '\uFEFF';
        const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
        triggerDownload(blob, filename);
        showSaveStatus('CSV å·²å¯¼å‡º');
    }

    // --- äº‹ä»¶ç›‘å¬ ---

    nav.addEventListener('click', function(e) {
      if (e.target.tagName === 'BUTTON') {
        const targetId = e.target.dataset.target;
        nav.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        pages.forEach(page => page.classList.toggle('active', page.id === targetId));
        localStorage.setItem('notebook-active-page', targetId);
      }
    });

    saveCurrentBtn.addEventListener('click', saveCurrentNote);
    saveAllBtn.addEventListener('click', () => {
        saveAllNotes();
        showSaveStatus('å…¨éƒ¨ç¬”è®°å·²ä¿å­˜ âœ“');
    });

    // æ–°å¢å¯¼å‡ºæŒ‰é’®çš„äº‹ä»¶ç›‘å¬
    exportTxtBtn.addEventListener('click', exportAsTxt);
    exportCsvBtn.addEventListener('click', exportAsCsv);

    let autoSaveTimer;
    textareas.forEach(textarea => {
      textarea.addEventListener('input', () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(saveAllNotes, 1000);
      });
    });

    window.addEventListener('beforeunload', saveAllNotes);

    // --- åˆå§‹åŒ– ---
    function initialize() {
      textareas.forEach(textarea => {
        const key = textarea.dataset.persist;
        if (key) {
          const savedValue = localStorage.getItem(key);
          if (savedValue !== null) textarea.value = savedValue;
        }
      });
      const lastActivePageId = localStorage.getItem('notebook-active-page');
      const targetButton = lastActivePageId ? nav.querySelector(`[data-target="${lastActivePageId}"]`) : nav.querySelector('.nav-button');
      if (targetButton) targetButton.click();
    }
    
    initialize();
  });
</script>

</body>
</html>
